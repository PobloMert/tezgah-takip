name: Build and Release TezgahTakip

on:
  push:
    tags:
      - 'v*'  # v1.0.0, v2.1.0 gibi tag'lerde Ã§alÄ±ÅŸÄ±r
  workflow_dispatch:  # Manuel tetikleme

jobs:
  build-windows:
    runs-on: windows-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install PyQt5>=5.15.0
        pip install SQLAlchemy>=2.0.0
        pip install requests>=2.25.0
        pip install packaging>=21.0
        pip install pyinstaller>=5.0.0
        
    - name: Build executable
      run: |
        python build_executable.py
        
    - name: Create release package
      run: |
        # ZIP dosyasÄ± oluÅŸtur
        Compress-Archive -Path "dist/*" -DestinationPath "TezgahTakip-${{ github.ref_name }}-Windows.zip"
        
    - name: Upload artifacts
      uses: actions/upload-artifact@v3
      with:
        name: TezgahTakip-Windows
        path: |
          TezgahTakip-${{ github.ref_name }}-Windows.zip
          dist/
          
  create-release:
    needs: build-windows
    runs-on: ubuntu-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4
      
    - name: Download artifacts
      uses: actions/download-artifact@v3
      with:
        name: TezgahTakip-Windows
        
    - name: Create Release
      id: create_release
      uses: actions/create-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: ${{ github.ref_name }}
        release_name: TezgahTakip ${{ github.ref_name }}
        body: |
          ## ğŸ‰ TezgahTakip ${{ github.ref_name }} YayÄ±nlandÄ±!
          
          ### ğŸ“¥ Ä°ndirme SeÃ§enekleri:
          - **Otomatik Kurulum**: `installer.bat` dosyasÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±n
          - **Portable Versiyon**: ZIP'i aÃ§Ä±p `TezgahTakip_Portable` klasÃ¶rÃ¼nÃ¼ kullanÄ±n
          - **Manuel Kurulum**: `TezgahTakip_Launcher.exe` dosyasÄ±nÄ± Ã§alÄ±ÅŸtÄ±rÄ±n
          
          ### ğŸ”„ GÃ¼ncelleme:
          - Mevcut kullanÄ±cÄ±lar launcher Ã¼zerinden otomatik gÃ¼ncelleyebilir
          - Yeni kurulum iÃ§in installer'Ä± kullanÄ±n
          
          ### ğŸ†• Bu Versiyondaki Yenilikler:
          - Otomatik gÃ¼ncelleme sistemi
          - GeliÅŸmiÅŸ tezgah iÅŸlemler menÃ¼sÃ¼
          - ArÄ±za kayÄ±t sistemi
          - Pil takip sistemi
          - Modern dashboard tasarÄ±mÄ±
          
          ### ğŸ’» Sistem Gereksinimleri:
          - Windows 10/11 (64-bit)
          - 4 GB RAM (Ã¶nerilen)
          - 500 MB disk alanÄ±
          
          ### ğŸ› Bilinen Sorunlar:
          - Ä°lk Ã§alÄ±ÅŸtÄ±rmada Windows Defender uyarÄ±sÄ± Ã§Ä±kabilir (gÃ¼venli olarak iÅŸaretleyin)
          
          ### ğŸ“ Destek:
          - GitHub Issues Ã¼zerinden sorun bildirebilirsiniz
          - DokÃ¼mantasyon iÃ§in README.md dosyasÄ±nÄ± inceleyin
          
        draft: false
        prerelease: false
        
    - name: Upload Release Asset
      uses: actions/upload-release-asset@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        upload_url: ${{ steps.create_release.outputs.upload_url }}
        asset_path: ./TezgahTakip-${{ github.ref_name }}-Windows.zip
        asset_name: TezgahTakip-${{ github.ref_name }}-Windows.zip
        asset_content_type: application/zip